<!doctype html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="junedeng" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="make the world a better place">
<meta property="og:type" content="website">
<meta property="og:title" content="Juney">
<meta property="og:url" content="https://junedeng2014.github.io/index.html">
<meta property="og:site_name" content="Juney">
<meta property="og:description" content="make the world a better place">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Juney">
<meta name="twitter:description" content="make the world a better place">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 'undefined',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: "",
      labels: ""
    }
  };
</script>



  <link rel="canonical" href="https://junedeng2014.github.io/"/>





  <title> Juney </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Juney</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
    
      <p class="site-subtitle"></p>
    
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>


    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="https://junedeng2014.github.io/2017/11/30/notes-of-loading-performance/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="June Deng">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/june.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Juney">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Juney" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/11/30/notes-of-loading-performance/" itemprop="url">
                  notes of loading performance
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-11-30T16:43:44+08:00">
                2017-11-30
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/skills/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          

          
          
             <span id="/2017/11/30/notes-of-loading-performance/" class="leancloud_visitors" data-flag-title="notes of loading performance">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Understanding-Low-Bandwith-and-High-Latency"><a href="#Understanding-Low-Bandwith-and-High-Latency" class="headerlink" title="Understanding Low Bandwith and High Latency"></a>Understanding Low Bandwith and High Latency</h1><ul>
<li>introduce tools to emulate network</li>
<li>Use timeouts to handle intermittent connectivity</li>
</ul>
<h1 id="Optimizing-Content-Efficiency"><a href="#Optimizing-Content-Efficiency" class="headerlink" title="Optimizing Content Efficiency"></a>Optimizing Content Efficiency</h1><h2 id="Eliminating-Unnecessary-Downloads"><a href="#Eliminating-Unnecessary-Downloads" class="headerlink" title="Eliminating Unnecessary Downloads"></a>Eliminating Unnecessary Downloads</h2><pre><code>TL;DR
- Inventory your own assets and third-party assests on your pages.
- Measure the performance of each asset:its value and its technical performance
- Determine if the resources are providing sufficient value
Eliminate unnecessary resources from application.
 - you&apos;ve always included resource x on your pages,but doest the cost of downloading and displaying it offset the value it delivers to the user? Can you measure and prove its value?
 - Does the resource(especially if it&apos;s a third-party resource) deliver consistent performance?Is that resource in the critical path,or need to be?If the rescource is in the critical path,could it be a single point of failure  for the site?That is,if the resource is unavailable,does it affect performance and the user experience of your page?
 - Does this resource need or have an SLA?Does this resource follow performance best practices:compression,caching,and so on.

Too often,pages contain resources that are unnecessary,or worse,that hinder page performance without delivering much value to the visitor or to the site they&apos;re hosted on.This applies equally to first-party and third-party resources and widgets.
</code></pre><h2 id="Optimizing-Encoding-and-Transfer-Size-of-Text-Based-Assets"><a href="#Optimizing-Encoding-and-Transfer-Size-of-Text-Based-Assets" class="headerlink" title="Optimizing Encoding and Transfer Size of Text-Based Assets"></a>Optimizing Encoding and Transfer Size of Text-Based Assets</h2><pre><code>1. Data compression 101
TL;DR:
    - Compression is the process of encoding information using fewer bits.
    - Eliminating unnecessary data always yields the best results.
    - There are many different compression techniques and algorithms.
    - You will need a varity of techniques to achieve the best compression.
2. Minification:preprocessing &amp; context-specific optimizations
TL;DR:
    - Content-specific optimizations can significantly reduce the size of delivered resources.
    - Content-specific optimizations are best applied as part of your build/release cycle.
3. Text compression with GZIP
TL;DR:
    - GZIP performs best on text-based assets:CSS,JavaScript,HTML
    - All modern browsers support GZIP compression and will automatically request it.
    - Your server must be configured to enable GZIP compression.
    - Some CDNs require special care to ensure that GZIP is enabled.

- Apply content-specific optimizations first: CSS, JS, and HTML minifiers.
- Apply GZIP to compress the minified output.

Enabling GZIP is one of the simplest and highest-payoff optimizations to implement, and yet, many people don&apos;t implement it. Most web servers compress content on your behalf, and you just need to verify that the server is correctly configured to compress all the content types that benefit from GZIP compression.


A quick and simple way to see GZIP in action is to open Chrome DevTools and inspect the “Size / Content” column in the Network panel: “Size” indicates the transfer size of the asset, and “Content” the uncompressed size of the asset.
</code></pre><h2 id="Image-Optimization"><a href="#Image-Optimization" class="headerlink" title="Image Optimization"></a>Image Optimization</h2><h3 id="Eliminating-and-replacing-images"><a href="#Eliminating-and-replacing-images" class="headerlink" title="Eliminating and replacing images"></a>Eliminating and replacing images</h3><pre><code>TL;DR:
    - Eliminate unnecessary image resources
    - Leverage CSS3 effects where possible
    - Use web fonts instead of encoding text in images
</code></pre><h3 id="Vector-vs-Raster-images"><a href="#Vector-vs-Raster-images" class="headerlink" title="Vector vs. Raster images"></a>Vector vs. Raster images</h3><pre><code>TL;DR：
    - Vector images are ideal for iamges that consists of geometric shapes
    - Vector images are zoom and resolution-independent
    - Raster images shoud be used of complex scenes with lots of irregular shapes and details
</code></pre><h3 id="Implications-of-high-resolution-screens"><a href="#Implications-of-high-resolution-screens" class="headerlink" title="Implications of high-resolution screens"></a>Implications of high-resolution screens</h3><pre><code>TL;DR
    - High resolution screens have multiple device pixels per css pixel
    - High resolution images require significantly higher number of pixels and bytes
    - Image optimization techniques are the same regardless of resolution

prefer vector images wherever possible.
if a raster image is required,deliver and optimize multiple variants of each imagewith of help of srcset and picture.
</code></pre><h3 id="Optimizing-vector-images"><a href="#Optimizing-vector-images" class="headerlink" title="Optimizing vector images"></a>Optimizing vector images</h3><pre><code>TL;DR
    - SVG is an XML-based image format
    - SVG files shoud be minified to reduce their size (tool:svgo)
    - SVG files to compressed with GZIP
</code></pre><h3 id="Optimizing-raster-images"><a href="#Optimizing-raster-images" class="headerlink" title="Optimizing raster images"></a>Optimizing raster images</h3><pre><code>TL;DR
    - A raster images is a grid of pixels
    - Each pixel encodes color and transparency information
    - Image compressors use a variety of techniques to reduce the number of required bits per pixel to reduce file size of the image
</code></pre><h3 id="Lossless-vs-loosy-image-compression"><a href="#Lossless-vs-loosy-image-compression" class="headerlink" title="Lossless vs loosy image compression"></a>Lossless vs loosy image compression</h3><pre><code>TL;DR
    - Due to how our eyes work,images are great candidates for lossy compression
    - Image optimization is a function of lossy and lossless compression
    - Differences in image formats are due to the difference in how and which lossy and lossless algorithms are used to optimize the images
    - There is no single best format or &quot;quality setting&quot; for all images:each combination of particular compressor and image contents produce a unique output
</code></pre><h3 id="Selecting-the-right-image-format"><a href="#Selecting-the-right-image-format" class="headerlink" title="Selecting the right image format"></a>Selecting the right image format</h3><pre><code>TL;DR
    - Start by selecting the right universal format:gif,png,jepg
    - Experiment and select the best settings for each format:quality,palette size,etc
    - Consider adding WebP and JPEG XR assets for modern clients
</code></pre><ol>
<li>Do you need animation? If so, GIF is the only universal choice</li>
<li>Do you need to preserve fine detail with highest resolution? Use PNG.</li>
<li>Are you optimizing a photo,screenshot,or a similar image asset? Use JPEG.</li>
</ol>
<p>WebP and JPEG XR :</p>
<pre><code>- Some CDNS provide image optimization as a service,including JPEG XR and WebP delivery.
- Some open-source tools(for example,PageSpeed for Apache or Nginx) automate the optimization,conversation,and serving of approriate assets.
- You can add additional application logic to detect the client,check which formats they support,and serve the best availlable image format.
</code></pre><h3 id="Tools-and-parameter-turning"><a href="#Tools-and-parameter-turning" class="headerlink" title="Tools and parameter turning"></a>Tools and parameter turning</h3><pre><code>- gifsicle:create and optimize GIF images
- jpegtran:optimize JPEG images
- optipng:lossless PNG optimization
- pngquant:lossy PNG optimization
</code></pre><h3 id="Deliver-scaled-image-assets"><a href="#Deliver-scaled-image-assets" class="headerlink" title="Deliver scaled image assets"></a>Deliver scaled image assets</h3><pre><code>TL;DR
    - Deliver scaled assets is one of the simplest and most effective optimizations
    - Pay close attention to large assets as they result in high overhead 
    - Reduce the number of unnecessary pixels by scaling your images to their display size
Image optimization boils down to two criteria: optimizing the number of bytes used to encode each image pixel, and optimizing the total number of pixels: the filesize of the image is simply the total number of pixels times the number of bytes used to encode each pixel. Nothing more, nothing less.
As a result, one of the simplest and most effective image optimization techniques is to ensure that we are not shipping any more pixels than needed to display the asset at its intended size in the browser. Sounds simple, right? Unfortunately, most pages fail this test for many of their image assets: typically, they ship larger assets and rely on the browser to rescale them - which also consumes extra CPU resources - and display them at a lower resolution.

**you should ensure that the number of unnecessary pixels is minimal, and that your large assets in particular are delivered as close as possible to their display size.**
</code></pre><h3 id="Image-optimization-checklist"><a href="#Image-optimization-checklist" class="headerlink" title="Image optimization checklist"></a>Image optimization checklist</h3><pre><code>- **Prefer vector formats**
- **Minify and compress SVG assets**
- **Pick best raster image format**
- **Experiment with optimal quality settings for raster formats**
- **Remove unnecessary image metadata**
- **Serve scaled images**
- **Automate**:invest into automated tools and infrastructure that will ensure that all of your image assets are always optimized
</code></pre><p>reference:<a href="https://developers.google.com/web/fundamentals/performance/optimizing-content-efficiency/image-optimization" target="_blank" rel="external">https://developers.google.com/web/fundamentals/performance/optimizing-content-efficiency/image-optimization</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="https://junedeng2014.github.io/2017/11/30/performance-notes/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="June Deng">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/june.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Juney">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Juney" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/11/30/performance-notes/" itemprop="url">
                  performance notes
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-11-30T15:32:43+08:00">
                2017-11-30
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/skills/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          

          
          
             <span id="/2017/11/30/performance-notes/" class="leancloud_visitors" data-flag-title="performance notes">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Mearsure-Performance-with-Rail-Model"><a href="#Mearsure-Performance-with-Rail-Model" class="headerlink" title="Mearsure Performance with Rail Model"></a>Mearsure Performance with Rail Model</h1><p>response,animation,idle,load<br>TL;DR</p>
<pre><code>- Focus on the user;the goal isn&apos;t to make your site perform fast on any specific device, its to ultimately make users happy.
- Respond to users immediately;acknowledge user input in under 100ms.
- When animating or scrolling,produce a frame in under 10ms.
- Maxmize main thread idle time.
- Keep users engaged;deliver interactive content in under 1000ms.
</code></pre><h2 id="Focus-on-the-user"><a href="#Focus-on-the-user" class="headerlink" title="Focus on the user"></a>Focus on the user</h2><h2 id="Response-respond-in-under-100ms"><a href="#Response-respond-in-under-100ms" class="headerlink" title="Response:respond in under 100ms"></a>Response:respond in under 100ms</h2><h2 id="Animation-produce-a-frame-in-10ms"><a href="#Animation-produce-a-frame-in-10ms" class="headerlink" title="Animation:produce a frame in 10ms"></a>Animation:produce a frame in 10ms</h2><h2 id="Idle-maximize-idle-time"><a href="#Idle-maximize-idle-time" class="headerlink" title="Idle:maximize idle time"></a>Idle:maximize idle time</h2><pre><code>Use idle time to complete deferred work. For example, keep pre-load data to aminimum so that your app loads fast, and use idle time to load remainning data/

Deferrend work should be grouped into blocks of about 50ms. Should a user begin interacting, then the highest priority is to respond to that.

To allow for &amp;lt;100ms response,the app must yield control back to main thread every &amp;lt;50ms,such that can execute its pixel pipeline,react to user input,and so on.

Working in 500ms blocks allows the task to finish while still ensuring instant response.
</code></pre><h2 id="Load-deliver-content-under-100ms"><a href="#Load-deliver-content-under-100ms" class="headerlink" title="Load:deliver content under 100ms"></a>Load:deliver content under 100ms</h2><pre><code>Load your site in under 1 second.
Focus on optimizing the critical rendering path to unblock rendering.
You don&apos;t have to load everything in under 1 second to produce the perception of a complete load.Enable progressive rendering and do some work in the background.Defer non-essential loads to periods of idle time.
</code></pre><p>reference:<a href="https://developers.google.com/web/fundamentals/performance/rail" target="_blank" rel="external">https://developers.google.com/web/fundamentals/performance/rail</a>  </p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/17/">17</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>


          
          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/june.jpg"
               alt="June Deng" />
          <p class="site-author-name" itemprop="name">June Deng</p>
          <p class="site-description motion-element" itemprop="description">make the world a better place</p>
        </div>
        <nav class="site-state motion-element">
        
          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">34</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">2</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">11</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">June Deng</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  




	





  





  

  




  
  
  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
      search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body").append('<div class="popoverlay">').css('overflow', 'hidden');
      $('.popup').toggle();
    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';
      $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = $( "entry", xmlResponse ).map(function() {
            return {
              title: $( "title", this ).text(),
              content: $("content",this).text(),
              url: $( "url" , this).text()
            };
          }).get();
          var $input = document.getElementById(search_id);
          var $resultContent = document.getElementById(content_id);
          $input.addEventListener('input', function(){
            var matchcounts = 0;
            var str='<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length > 1) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var content_index = [];
                var data_title = data.title.trim().toLowerCase();
                var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                var data_url = decodeURIComponent(data.url);
                var index_title = -1;
                var index_content = -1;
                var first_occur = -1;
                // only match artiles with not empty titles and contents
                if(data_title != '') {
                  keywords.forEach(function(keyword, i) {
                    index_title = data_title.indexOf(keyword);
                    index_content = data_content.indexOf(keyword);
                    if( index_title >= 0 || index_content >= 0 ){
                      isMatch = true;
                      if (i == 0) {
                        first_occur = index_content;
                      }
                    }

                  });
                }
                // show search results
                if (isMatch) {
                  matchcounts += 1;
                  str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                  var content = data.content.trim().replace(/<[^>]+>/g,"");
                  if (first_occur >= 0) {
                    // cut out 100 characters
                    var start = first_occur - 20;
                    var end = first_occur + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if(start == 0){
                      end = 50;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    var match_content = content.substring(start, end);
                    // highlight all keywords
                    keywords.forEach(function(keyword){
                      var regS = new RegExp(keyword, "gi");
                      match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                    });

                    str += "<p class=\"search-result\">" + match_content +"...</p>"
                  }
                  str += "</li>";
                }
              })};
            str += "</ul>";
            if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
            if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
            $resultContent.innerHTML = str;
          });
          proceedsearch();
        }
      });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".popoverlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>


  

  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("NCBBKuPTKFFr38BXkz4ma3RX-gzGzoHsz", "U4EzaoNdgEnqamDu4y43RJbd");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  


</body>
</html>
